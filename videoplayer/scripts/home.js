function testAPIs(){write("hello2");Office.context.document.settings.set("mySetting",2);Office.context.document.settings.saveAsync(function(n){write("Settings saved with status: "+n.status)})}function write(n){document.getElementById("debug").innerHTML=document.getElementById("debug").innerHTML+"\n"+n}function getParameterByName(n,t){t||(t=window.location.href);n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function loadLicenseInfo(){var n,t;write("loading license info");try{var i=atob(decodeURIComponent(getParameterByName("et"))),r="",f=String.fromCharCode(00);for(n=0;n<i.length;n++)i[n]!=f&&(r+=i[n]);t=$($.parseXML(r)).find("t");orgId=t.attr("oid");liveId=t.attr("cid");userId=orgId;liveId&&(userId=liveId);acquisitionDate=t.attr("ad");ga("set","userId",userId)}catch(u){write("Error licensing: "+u.message);ga("send","event","videoplayer","licensing",u.message)}write("user ID is "+userId)}function errorMessage(n){document.getElementById("innerErrorDiv").innerHTML=n;var t=document.getElementById("errorDiv");$("#errorDiv").fadeIn()}function createVideo(){function e(){if(typeof Storage!="undefined"){if(!localStorage.getItem("lastUseDay")){var n=new Date;localStorage.setItem("lastUseDay",n.toDateString());localStorage.setItem("usedDays",1)}}else write("Sorry, your browser does not support Web Storage...")}var n,t,i,o,h;n=Office.context.document.settings.get("vid");var u=0,r=0,f=0;if(n?(u=Office.context.document.settings.get("autoplay"),r=Office.context.document.settings.get("starttime"),f=Office.context.document.settings.get("endtime")):(n=document.getElementById("videoID").value,t=document.getElementById("timeinput").value.split(":"),i=document.getElementById("endtimeinput").value.split(":"),document.getElementById("autoplay").checked&&(u=1),document.getElementById("customstarttime").checked&&(r=+t[t.length-1]+ +t[t.length-2]*60,t.length>2&&(r+=+t[t.length-3]*3600)),document.getElementById("customendtime").checked&&(f=+i[i.length-1]+ +i[i.length-2]*60,i.length>2&&(f+=+i[i.length-3]*3600)),write("setting video params")),Office.context.document.settings.get("slideId")){o=Office.context.document.settings.get("slideId");function s(){Office.context.document.getSelectedDataAsync(Office.CoercionType.SlideRange,{},function(n){var t=n.error;n.status===Office.AsyncResultStatus.Failed?write(t.name+": "+t.message):n.value.slides[0].id==o?setTimeout(s,600):window.location.reload()})}s()}n.indexOf("youtube.com")!=-1||n.indexOf("youtu.be")!=-1?(ga("send","event","videoplayer","setvideo","youtube"),e(),write("there's a video to create"),Office.context.document.settings.set("vid",n),Office.context.document.settings.set("autoplay",u),Office.context.document.settings.set("starttime",r),Office.context.document.settings.set("endtime",f),Office.context.document.settings.saveAsync(function(n){if(write("Settings saved with status: "+n.status),!0){document.getElementById("player").style.visibility="visible";var t=document.createElement("script");t.type="text/javascript";t.src="../scripts/youtube.js";$("body").append(t)}else $("#iframed").fadeIn(),$("#iframed").addClass("inWAC"),document.getElementById("iframed").style.visibility="visible",write("iframedo"),$("#iframed").click(function(){window.open(Office.context.document.settings.get("vid"))})})):n.indexOf("vimeo.com")!=-1?(ga("send","event","videoplayer","setvideo","vimeo"),e(),Office.context.document.settings.set("vid",n),Office.context.document.settings.set("autoplay",u),Office.context.document.settings.set("starttime",r),Office.context.document.settings.set("endtime",f),Office.context.document.settings.saveAsync(function(){var i,f,e;if(1){write("creating vimeox");var f=n.indexOf("meo.com/"),e=n.substring(f+8),t=document.getElementById("ifrm");t.style.height="100%";write("heighta: "+t.height);i="?";r&&(i+="&#t="+r+"s");u&&(i+="&autoplay=1");i+="&title=0&amp;byline=0&amp;portrait=0";t.setAttribute("src","//player.vimeo.com/video/"+e+i);write("heighto: "+t.height);write(t.style.width);write("zindex: "+t.style.zIndex)}else f=n.indexOf("meo.com/"),e=n.substring(f+8),window.location.href="//player.vimeo.com/video/"+e+"?title=0&amp;byline=0&amp;portrait=0"})):n.indexOf("liveleakjhkjkljkl;jkl.com")!=-1?(h=document.createElement("a"),h.setAttribute(),Office.context.document.settings.set("vid",n),Office.context.document.settings.saveAsync(function(){})):errorMessage("Choose a valid URL for your video.")}function saveVid(){}var orgId,liveId,userId,acqusitionDate,isPro=!1,readyToRegister=!1,signedIn=!1,pass,pingingForPayment=!1;Office.initialize=function(){$(document).ready(function(){function r(t){checkServerDatabase(function(i){i==200?(signedIn&&localStorage.setItem("email",userId),write("result succeeded"),ga("send","event","videoplayer","purchasesucceeded"),pingingForPayment=!1,$("#proPrompt").fadeOut(),n()):pingingForPayment&&(setTimeout(function(){r(t)},2e3),ga("send","event","videoplayer","checkping"))},t)}function n(){$(".startsDisabled").prop("disabled",!1);$("#timeinput").css("user-select","text");$("#endtimeinput").css("user-select","text")}function u(){$("#proPrompt").fadeIn()}var t,i,f;if($("#iframed").fadeOut(),$("#setVid").click(function(){if(document.getElementById("videoID").value=="debug")errorMessage("Click <a href='mailto:webvideoplayer@outlook.com?subject=Support Request for "+userId+"&body=Please enable my account. Thank you!'>here<\/a> to send ID code "+userId+" for support.");else{var n=!0;Office.context.document.getSelectedDataAsync(Office.CoercionType.SlideRange,{},function(t){var i,r;n&&(i=t.error,write("selecteddata result is "+t.status),t.status===Office.AsyncResultStatus.Failed?(write(i.name+": "+i.message),createVideo()):(r=t.value.slides[0].id,Office.context.document.settings.set("slideId",r),Office.context.document.settings.saveAsync(function(){createVideo()})))});setTimeout(function(){n=!1;createVideo()},400)}}),$("#errorDiv").click(function(){$(this).fadeOut()}),$("#timeinput").change(function(){$("#customstarttime").attr("checked",!0)}),document.getElementById("endtimeinput").onchange=function(){document.getElementById("customendtime").checked=!0},$(".payButton").click(function(){userId&&(window.open("../pages/purchasewindow.html?custom="+encodeURIComponent(userId)),pingingForPayment=!0,$("#waitingPay").show(),setTimeout(r,1e4),ga("send","event","videoplayer","checkping"))}),$("#email").focus(function(){$("#email").val()=="email"&&$("#email").attr({value:""})}),$("#password").focus(function(){var t,i,u;if($("#password").val()=="password"){$("#password").attr({value:""});t=document.getElementById("password");i=t.cloneNode(!1);i.type="password";t.parentNode.replaceChild(i,t);$("#password").focus();function f(){var t=$("#email").val();$("#password").val().length>3&&t.length>3&&t.indexOf("@")>-1&&t.indexOf(".")>-1?u=setTimeout(function(){pass=sha256("wvp"+$("#password").val());write("pass="+pass);userId=$("#email").val();signedIn=!0;checkServerDatabase(function(t){t==200?(write("found the id"),$("#proPrompt").fadeOut(),n(),$("#signinlink").fadeOut(),write("hiding sign in"),localStorage.setItem("email",userId)):(write("not found"),$("#registerSignIn").css("background-color","#bbe2fa"),readyToRegister=!0)},pass)},500):($("#registerSignIn").css("background-color","#c8c8c8"),readyToRegister=!1)}$(".registerBox").keyup(function(){readyToRegister=!1;$("#registerSignIn").css("background-color","#c8c8c8");u&&clearInterval(u);f()});$("#registerSignIn").click(function(){readyToRegister&&(window.open("../pages/purchasewindowpw.html?myUserId="+encodeURIComponent(userId)+"&myPass="+encodeURIComponent(pass)),pingingForPayment=!0,$("#waitingPay").show(),setTimeout(function(){r(pass)},1e4),ga("send","event","videoplayer","checkpingpw"))})}}),$("#cancelPay").click(function(){$("#waitingPay").hide();pingingForPayment=!1}),$("#contactlink").click(function(){window.open("mailto:webvideoplayer@outlook.com")}),$("#helplink").click(function(){window.open("https://www.michael-saunders.com/videoplayer/pages/info.html#howto")}),$("#privacylink").click(function(){window.open("https://www.michael-saunders.com/videoplayer/pages/privacy.html")}),$("#ratelink").click(function(){window.open("https://store.office.com/writereview.aspx?assetid=WA104221182")}),$("#signinlink").click(function(){$.getScript("https://michael-saunders.com/videoplayer/scripts/sha256.js",function(){});$("#proContent").fadeOut(200);$("#buyNow").fadeOut(200);$(".registering").fadeOut(200);setTimeout(function(){$("#signInText").html("Sign in to Web Video Player to access your premium features.");$("#registerSignInText").html("Sign in");$("#email").html("email");$(".registering").fadeIn(200)},250)}),typeof Storage!="undefined"?localStorage.getItem("lastUseDay")&&(t=new Date,write("my used days="+localStorage.getItem("usedDays")),write("datestring="+t.toDateString()),localStorage.getItem("lastUseDay")!=t.toDateString()&&(localStorage.setItem("lastUseDay",t.toDateString()),i=localStorage.getItem("usedDays"),i++,localStorage.setItem("usedDays",i),i>1&&write("show rating link"))):write("Sorry, your browser does not support Web Storage..."),Office.context.document.settings.get("vid"))if(ga("send","event","videoplayer","loadplayer","existingvideo"),Office.context.document.settings.get("slideId")){f=Office.context.document.settings.get("slideId");function e(){Office.context.document.getSelectedDataAsync(Office.CoercionType.SlideRange,{},function(n){var t=n.error;n.status===Office.AsyncResultStatus.Failed?write(t.name+": "+t.message):n.value.slides[0].id==f?createVideo():setTimeout(e,600)})}e()}else createVideo();else{function o(n){if(n.status=="failed")switch(n.error.code){case 12004:write("Domain is not trusted");break;case 12005:write("HTTPS is required");break;case 12007:write("A dialog is already opened.");break;default:write(n.error.message)}else dialog=n.value,dialog.addEventHandler(Office.EventType.DialogMessageReceived,messageHandler),dialog.addEventHandler(Office.EventType.DialogEventReceived,eventHandler)}ga("send","event","videoplayer","loadplayer","novideo");loadLicenseInfo();function checkServerDatabase(n,t){write("checking for pw"+t);var i="https://michael-saunders.com/server/";t?(i+="checkdatabasepw.php",$.post(i,{custom:userId,pass:t}).done(function(t){t.includes("200")?n(200):t.includes("404")?n(404):n(t)}).fail(function(){n(404)})):(i+="checkdatabase.php",write("correct entrypoint"),$.post(i,{custom:userId}).done(function(t){t.includes("200")?n(200):t.includes("404")?n(404):n(t)}).fail(function(){n(404)}))}userId?($("#signinlink").hide(),checkServerDatabase(function(t){t==200?(write("result succeeded"),n()):setTimeout(function(){checkServerDatabase(function(i){i==200?(write("result succeeded"),n()):(Office.context.commerceAllowed?u():Office.context.commerceAllowed?(document.getElementById("premiumFeatures").title+=". Sign in before purchase.",$("#premiumFeatures").hide()):($("#premiumFeatures").hide(),$("#helpLink").attr("href","../pages/helpnocommerce.html")),write("result status: "+t))})},2e3)})):localStorage.getItem("email")?(n(),userId=email,signedIn=!0,$("#signinlink").hide(),ga("send","event","videoplayer","autosignin",localStorage.getItem("email"))):Office.context.commerceAllowed?($("#price").html("$9.95"),write("adjust price"),u(),$.getScript("https://michael-saunders.com/videoplayer/scripts/sha256.js",function(){}),$("#proContent").hide(),$("#buyNow").hide(),setTimeout(function(){$("#signInText").html('Register and contribute <b><span id="price">$9.95<\/span><\/b> to unlock the <a href="javascript:;" class="linkstyle" id="registerHelp" style="color:#bbe2fa">premium features<\/a> for all your videos.');$("#registerHelp").click(function(){window.open("https://www.michael-saunders.com/videoplayer/pages/help.html")});$("#registerSignInText").html("Register");$(".registering").fadeIn(200)},250),document.getElementById("premiumFeatures").title+=". Sign in to Office before purchase."):($("#premiumFeatures").hide(),$("#helpLink").attr("href","../pages/helpnocommerce.html"));document.getElementById("cloak").style.visibility="hidden";$("#videoID").focus()}})}